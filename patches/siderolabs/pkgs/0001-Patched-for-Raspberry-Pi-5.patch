From 2ab696f706996632317b04d0524547f058a4d591 Mon Sep 17 00:00:00 2001
From: Patrick Hunziker <patrick@hunziker.io>
Date: Sun, 8 Jun 2025 11:46:31 +0200
Subject: [PATCH] Patched for Raspberry Pi 5

---
 Pkgfile                   |   8 +--
 kernel/build/config-arm64 | 118 ++++++++++++++++++++++++++++++++++----
 kernel/prepare/pkg.yaml   |   6 +-
 3 files changed, 114 insertions(+), 18 deletions(-)

diff --git a/Pkgfile b/Pkgfile
index f399532..14c1704 100644
--- a/Pkgfile
+++ b/Pkgfile
@@ -84,10 +84,10 @@ vars:
   kspp_sha256: e7bd01ae14372a1382aaf978f5d7fa0673cfea6c77bf40d0bebb2f3984ede2d3
   kspp_sha512: ac31ec1a4f88a46e2bd9c16e99991c0b96796c8c014ffc30e3535942a89db855243750b3c2b27fd9e7f90734c68b1d06deeb48684ee88dccdb7ec6360aba4371
 
-  # renovate: datasource=git-tags extractVersion=^v(?<version>.*)$ depName=git://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git
-  linux_version: 6.12.23
-  linux_sha256: d8d95404f8deeb7ff6992c0df855025062e9e8182bca6daa27ef2e9275d27749
-  linux_sha512: c972c81f985c5470d4c1b4642214f9ddcb49cecbf1e6a99e52a24ce480d06d7ee7ca7f0dcee7bc4fe00da2f41f0bec4fcd569b6034522845ba5f0ad9ea0e1958
+  # renovate: datasource=git-tags extractVersion=^v(?<version>.*)$ depName=https://github.com/raspberrypi/linux.git
+  linux_version: stable_20250428
+  linux_sha256: c95906cfbc7808de5860c6d86537bea22e3501f600a5209de59a86cb436886f6
+  linux_sha512: 0ed5d490c491e590b5980dccf6fcac0dd3c47accbfacd40d91507c12801cff34fa6a1c68991c8a6c57bb259c909121414766f35a0b11c4bd5d62c3e11d710839
 
   # renovate: datasource=git-tags extractVersion=^libaio-(?<version>.*)$ depName=https://pagure.io/libaio.git
   libaio_version: 0.3.113
diff --git a/kernel/build/config-arm64 b/kernel/build/config-arm64
index 6efcadc..9b215b0 100644
--- a/kernel/build/config-arm64
+++ b/kernel/build/config-arm64
@@ -1,6 +1,6 @@
 #
 # Automatically generated file; DO NOT EDIT.
-# Linux/arm64 6.12.23 Kernel Configuration
+# Linux/arm64 6.12.25 Kernel Configuration
 #
 CONFIG_CC_VERSION_TEXT="gcc (GCC) 14.2.0"
 CONFIG_CC_IS_GCC=y
@@ -432,8 +432,8 @@ CONFIG_ROCKCHIP_ERRATUM_3588001=y
 CONFIG_SOCIONEXT_SYNQUACER_PREITS=y
 # end of ARM errata workarounds via the alternatives framework
 
-CONFIG_ARM64_4K_PAGES=y
-# CONFIG_ARM64_16K_PAGES is not set
+# CONFIG_ARM64_4K_PAGES is not set
+CONFIG_ARM64_16K_PAGES=y
 # CONFIG_ARM64_64K_PAGES is not set
 # CONFIG_ARM64_VA_BITS_39 is not set
 CONFIG_ARM64_VA_BITS_48=y
@@ -639,7 +639,7 @@ CONFIG_CPU_FREQ_STAT=y
 # CONFIG_CPU_FREQ_DEFAULT_GOV_PERFORMANCE is not set
 # CONFIG_CPU_FREQ_DEFAULT_GOV_POWERSAVE is not set
 # CONFIG_CPU_FREQ_DEFAULT_GOV_USERSPACE is not set
-# CONFIG_CPU_FREQ_DEFAULT_GOV_ONDEMAND is not set
+CONFIG_CPU_FREQ_DEFAULT_GOV_ONDEMAND=y
 # CONFIG_CPU_FREQ_DEFAULT_GOV_CONSERVATIVE is not set
 CONFIG_CPU_FREQ_DEFAULT_GOV_SCHEDUTIL=y
 CONFIG_CPU_FREQ_GOV_PERFORMANCE=y
@@ -1310,7 +1310,7 @@ CONFIG_NETLABEL=y
 # CONFIG_MPTCP is not set
 CONFIG_NETWORK_SECMARK=y
 CONFIG_NET_PTP_CLASSIFY=y
-# CONFIG_NETWORK_PHY_TIMESTAMPING is not set
+CONFIG_NETWORK_PHY_TIMESTAMPING=y
 CONFIG_NETFILTER=y
 CONFIG_NETFILTER_ADVANCED=y
 CONFIG_BRIDGE_NETFILTER=y
@@ -2180,6 +2180,7 @@ CONFIG_TI_SCI_PROTOCOL=y
 CONFIG_TURRIS_MOX_RWTM=y
 # CONFIG_ARM_FFA_TRANSPORT is not set
 # CONFIG_GOOGLE_FIRMWARE is not set
+CONFIG_FIRMWARE_RP1=y
 
 #
 # EFI (Extensible Firmware Interface) Support
@@ -2358,6 +2359,7 @@ CONFIG_OF_RESERVED_MEM=y
 CONFIG_OF_RESOLVE=y
 CONFIG_OF_OVERLAY=y
 CONFIG_OF_NUMA=y
+# CONFIG_OF_CONFIGFS is not set
 # CONFIG_PARPORT is not set
 CONFIG_PNP=y
 CONFIG_PNP_DEBUG_MESSAGES=y
@@ -2415,6 +2417,7 @@ CONFIG_NVME_TARGET_AUTH=y
 #
 # Misc devices
 #
+CONFIG_BCM2835_SMI=m
 # CONFIG_AD525X_DPOT is not set
 # CONFIG_DUMMY_IRQ is not set
 # CONFIG_PHANTOM is not set
@@ -2445,6 +2448,8 @@ CONFIG_SRAM=y
 # CONFIG_NSM is not set
 # CONFIG_MARVELL_CN10K_DPI is not set
 # CONFIG_C2PORT is not set
+CONFIG_RP1_PIO=y
+CONFIG_WS2812_PIO_RP1=y
 
 #
 # EEPROM support
@@ -3638,6 +3643,8 @@ CONFIG_HYPERV_KEYBOARD=y
 #
 # Character devices
 #
+# CONFIG_BRCM_CHAR_DRIVERS is not set
+CONFIG_BCM2835_SMI_DEV=m
 CONFIG_TTY=y
 CONFIG_VT=y
 CONFIG_CONSOLE_TRANSLATIONS=y
@@ -3728,6 +3735,7 @@ CONFIG_SERIAL_XILINX_PS_UART_CONSOLE=y
 CONFIG_SERIAL_MVEBU_UART=y
 CONFIG_SERIAL_MVEBU_CONSOLE=y
 # CONFIG_SERIAL_OWL is not set
+# CONFIG_SERIAL_RPI_FW is not set
 # end of Serial drivers
 
 CONFIG_SERIAL_MCTRL_GPIO=y
@@ -3802,6 +3810,7 @@ CONFIG_TCG_CRB=y
 # CONFIG_TCG_TIS_ST33ZP24_SPI is not set
 # CONFIG_XILLYBUS is not set
 # CONFIG_XILLYUSB is not set
+CONFIG_RASPBERRYPI_GPIOMEM=y
 # end of Character devices
 
 #
@@ -3840,6 +3849,7 @@ CONFIG_I2C_ALGOBIT=y
 # PC SMBus host controller drivers
 #
 CONFIG_I2C_CCGX_UCSI=y
+CONFIG_I2C_BCM2708=y
 # CONFIG_I2C_ALI1535 is not set
 # CONFIG_I2C_ALI1563 is not set
 # CONFIG_I2C_ALI15X3 is not set
@@ -3962,7 +3972,7 @@ CONFIG_SPI_BCM_QSPI=y
 # CONFIG_SPI_HISI_KUNPENG is not set
 # CONFIG_SPI_HISI_SFC_V3XX is not set
 # CONFIG_SPI_NXP_FLEXSPI is not set
-# CONFIG_SPI_GPIO is not set
+CONFIG_SPI_GPIO=y
 # CONFIG_SPI_IMX is not set
 # CONFIG_SPI_FSL_SPI is not set
 # CONFIG_SPI_FSL_DSPI is not set
@@ -3979,6 +3989,7 @@ CONFIG_SPI_ORION=y
 CONFIG_SPI_PL022=y
 CONFIG_SPI_ROCKCHIP=y
 # CONFIG_SPI_ROCKCHIP_SFC is not set
+CONFIG_SPI_RP2040_GPIO_BRIDGE=y
 # CONFIG_SPI_RSPI is not set
 # CONFIG_SPI_RZV2M_CSI is not set
 # CONFIG_SPI_QCOM_QSPI is not set
@@ -4067,7 +4078,7 @@ CONFIG_PINCTRL_AXP209=y
 CONFIG_PINCTRL_BM1880=y
 # CONFIG_PINCTRL_CY8C95X0 is not set
 CONFIG_PINCTRL_MAX77620=y
-# CONFIG_PINCTRL_MCP23S08 is not set
+CONFIG_PINCTRL_MCP23S08=y
 # CONFIG_PINCTRL_MICROCHIP_SGPIO is not set
 # CONFIG_PINCTRL_OCELOT is not set
 CONFIG_PINCTRL_RK805=y
@@ -4077,7 +4088,9 @@ CONFIG_PINCTRL_SINGLE=y
 # CONFIG_PINCTRL_STMFX is not set
 # CONFIG_PINCTRL_SX150X is not set
 CONFIG_PINCTRL_ZYNQMP=y
+CONFIG_PINCTRL_RP1=y
 # CONFIG_PINCTRL_OWL is not set
+CONFIG_PINCTRL_BCM2712=y
 CONFIG_PINCTRL_BCM2835=y
 CONFIG_PINCTRL_IPROC_GPIO=y
 CONFIG_PINCTRL_NS2_MUX=y
@@ -4241,6 +4254,7 @@ CONFIG_GPIO_GENERIC=y
 # CONFIG_GPIO_AMDPT is not set
 CONFIG_GPIO_RASPBERRYPI_EXP=y
 CONFIG_GPIO_BCM_XGS_IPROC=y
+CONFIG_GPIO_BCM_VIRT=y
 CONFIG_GPIO_BRCMSTB=y
 # CONFIG_GPIO_CADENCE is not set
 # CONFIG_GPIO_DAVINCI is not set
@@ -4258,6 +4272,7 @@ CONFIG_GPIO_DWAPB=y
 CONFIG_GPIO_MVEBU=y
 CONFIG_GPIO_MXC=y
 CONFIG_GPIO_PL061=y
+# CONFIG_GPIO_PWM is not set
 CONFIG_GPIO_RCAR=y
 CONFIG_GPIO_ROCKCHIP=y
 CONFIG_GPIO_RTD=y
@@ -4296,6 +4311,7 @@ CONFIG_GPIO_PCA953X_IRQ=y
 #
 # MFD GPIO expanders
 #
+# CONFIG_GPIO_FSM is not set
 CONFIG_GPIO_MAX77620=y
 # end of MFD GPIO expanders
 
@@ -4363,6 +4379,7 @@ CONFIG_POWER_RESET_SYSCON=y
 CONFIG_POWER_SUPPLY=y
 # CONFIG_POWER_SUPPLY_DEBUG is not set
 CONFIG_POWER_SUPPLY_HWMON=y
+# CONFIG_RPI_POE_POWER is not set
 # CONFIG_GENERIC_ADC_BATTERY is not set
 # CONFIG_IP5XXX_POWER is not set
 # CONFIG_TEST_POWER is not set
@@ -4641,7 +4658,7 @@ CONFIG_AMLOGIC_THERMAL=y
 # Broadcom thermal drivers
 #
 CONFIG_BCM2711_THERMAL=y
-# CONFIG_BCM2835_THERMAL is not set
+CONFIG_BCM2835_THERMAL=y
 # CONFIG_BRCMSTB_THERMAL is not set
 CONFIG_BCM_NS_THERMAL=y
 CONFIG_BCM_SR_THERMAL=y
@@ -4811,6 +4828,7 @@ CONFIG_MFD_MAX77620=y
 # CONFIG_MFD_QCOM_RPM is not set
 CONFIG_MFD_SPMI_PMIC=y
 # CONFIG_MFD_SY7636A is not set
+CONFIG_MFD_RASPBERRYPI_POE_HAT=y
 # CONFIG_MFD_RDC321X is not set
 # CONFIG_MFD_RT4831 is not set
 # CONFIG_MFD_RT5033 is not set
@@ -4877,6 +4895,7 @@ CONFIG_MFD_SYSCON=y
 # CONFIG_MFD_CS40L50_I2C is not set
 # CONFIG_MFD_CS40L50_SPI is not set
 # CONFIG_MFD_INTEL_M10_BMC_SPI is not set
+CONFIG_MFD_RP1=y
 # CONFIG_MFD_RSMU_I2C is not set
 # CONFIG_MFD_RSMU_SPI is not set
 # end of Multifunction device drivers
@@ -4940,6 +4959,8 @@ CONFIG_REGULATOR_QCOM_SPMI=y
 # CONFIG_REGULATOR_QCOM_USB_VBUS is not set
 # CONFIG_REGULATOR_RAA215300 is not set
 # CONFIG_REGULATOR_RASPBERRYPI_TOUCHSCREEN_ATTINY is not set
+# CONFIG_REGULATOR_RASPBERRYPI_TOUCHSCREEN_V2 is not set
+# CONFIG_REGULATOR_WAVESHARE_TOUCHSCREEN is not set
 CONFIG_REGULATOR_RK808=y
 # CONFIG_REGULATOR_RT4801 is not set
 # CONFIG_REGULATOR_RT4803 is not set
@@ -5069,6 +5090,7 @@ CONFIG_V4L_MEM2MEM_DRIVERS=y
 #
 # Atmel media platform drivers
 #
+# CONFIG_VIDEO_BCM2835_UNICAM_LEGACY is not set
 # CONFIG_VIDEO_BCM2835_UNICAM is not set
 
 #
@@ -5130,7 +5152,9 @@ CONFIG_V4L_MEM2MEM_DRIVERS=y
 #
 # Raspberry Pi media platform drivers
 #
+# CONFIG_VIDEO_RPI_HEVC_DEC is not set
 # CONFIG_VIDEO_RASPBERRYPI_PISP_BE is not set
+# CONFIG_VIDEO_RP1_CFE is not set
 
 #
 # Renesas media platform drivers
@@ -5206,8 +5230,10 @@ CONFIG_VIDEOBUF2_VMALLOC=m
 #
 # Lens drivers
 #
+# CONFIG_VIDEO_AD5398 is not set
 # CONFIG_VIDEO_AD5820 is not set
 # CONFIG_VIDEO_AK7375 is not set
+# CONFIG_VIDEO_BU64754 is not set
 # CONFIG_VIDEO_DW9714 is not set
 # CONFIG_VIDEO_DW9719 is not set
 # CONFIG_VIDEO_DW9768 is not set
@@ -5276,6 +5302,7 @@ CONFIG_VIDEOBUF2_VMALLOC=m
 # CONFIG_VIDEO_TW9903 is not set
 # CONFIG_VIDEO_TW9906 is not set
 # CONFIG_VIDEO_TW9910 is not set
+# CONFIG_VIDEO_IRS1125 is not set
 # CONFIG_VIDEO_VPX3220 is not set
 
 #
@@ -5490,6 +5517,7 @@ CONFIG_DRM_PANEL=y
 # CONFIG_DRM_PANEL_ILITEK_ILI9341 is not set
 # CONFIG_DRM_PANEL_ILITEK_ILI9805 is not set
 # CONFIG_DRM_PANEL_ILITEK_ILI9806E is not set
+# CONFIG_DRM_PANEL_ILITEK_ILI9806E_SPI is not set
 # CONFIG_DRM_PANEL_ILITEK_ILI9881C is not set
 # CONFIG_DRM_PANEL_ILITEK_ILI9882T is not set
 # CONFIG_DRM_PANEL_INNOLUX_EJ030NA is not set
@@ -5558,6 +5586,7 @@ CONFIG_DRM_PANEL=y
 CONFIG_DRM_PANEL_SIMPLE=y
 # CONFIG_DRM_PANEL_SYNAPTICS_R63353 is not set
 # CONFIG_DRM_PANEL_TDO_TL070WSH30 is not set
+# CONFIG_DRM_PANEL_TPO_Y17P is not set
 # CONFIG_DRM_PANEL_TPO_TD028TTEC1 is not set
 # CONFIG_DRM_PANEL_TPO_TD043MTEA1 is not set
 # CONFIG_DRM_PANEL_TPO_TPG110 is not set
@@ -5565,6 +5594,8 @@ CONFIG_DRM_PANEL_SIMPLE=y
 # CONFIG_DRM_PANEL_VISIONOX_R66451 is not set
 # CONFIG_DRM_PANEL_VISIONOX_RM69299 is not set
 # CONFIG_DRM_PANEL_VISIONOX_VTDR6130 is not set
+# CONFIG_DRM_PANEL_WAVESHARE_TOUCHSCREEN is not set
+# CONFIG_DRM_PANEL_WAVESHARE_TOUCHSCREEN_V2 is not set
 # CONFIG_DRM_PANEL_WIDECHIPS_WS2401 is not set
 # CONFIG_DRM_PANEL_XINPENG_XPP055C272 is not set
 # end of Display Panels
@@ -5679,6 +5710,7 @@ CONFIG_DRM_PANEL_ORIENTATION_QUIRKS=y
 # Frame buffer Devices
 #
 CONFIG_FB=y
+CONFIG_FB_BCM2708=y
 # CONFIG_FB_CIRRUS is not set
 # CONFIG_FB_PM2 is not set
 # CONFIG_FB_IMX is not set
@@ -5720,6 +5752,7 @@ CONFIG_FB_HYPERV=y
 CONFIG_FB_SIMPLE=y
 # CONFIG_FB_SSD1307 is not set
 # CONFIG_FB_SM712 is not set
+CONFIG_FB_RPISENSE=y
 CONFIG_FB_CORE=y
 CONFIG_FB_NOTIFY=y
 # CONFIG_FIRMWARE_EDID is not set
@@ -5753,6 +5786,7 @@ CONFIG_BACKLIGHT_CLASS_DEVICE=y
 # CONFIG_BACKLIGHT_KTD2801 is not set
 # CONFIG_BACKLIGHT_KTZ8866 is not set
 # CONFIG_BACKLIGHT_PWM is not set
+# CONFIG_BACKLIGHT_RPI is not set
 # CONFIG_BACKLIGHT_QCOM_WLED is not set
 # CONFIG_BACKLIGHT_ADP8860 is not set
 # CONFIG_BACKLIGHT_ADP8870 is not set
@@ -5831,6 +5865,48 @@ CONFIG_SND_SOC_GENERIC_DMAENGINE_PCM=y
 # CONFIG_SND_ATMEL_SOC is not set
 # CONFIG_SND_BCM2835_SOC_I2S is not set
 # CONFIG_SND_BCM63XX_I2S_WHISTLER is not set
+# CONFIG_SND_BCM2708_SOC_CHIPDIP_DAC is not set
+# CONFIG_SND_BCM2708_SOC_GOOGLEVOICEHAT_SOUNDCARD is not set
+# CONFIG_SND_BCM2708_SOC_HIFIBERRY_ADC is not set
+# CONFIG_SND_BCM2708_SOC_HIFIBERRY_ADC8X is not set
+# CONFIG_SND_BCM2708_SOC_HIFIBERRY_DAC is not set
+# CONFIG_SND_BCM2708_SOC_HIFIBERRY_DACPLUS is not set
+# CONFIG_SND_BCM2708_SOC_HIFIBERRY_DACPLUSHD is not set
+# CONFIG_SND_BCM2708_SOC_HIFIBERRY_DACPLUSADC is not set
+# CONFIG_SND_BCM2708_SOC_HIFIBERRY_DACPLUSADCPRO is not set
+# CONFIG_SND_BCM2708_SOC_HIFIBERRY_DACPLUSDSP is not set
+# CONFIG_SND_BCM2708_SOC_HIFIBERRY_DIGI is not set
+# CONFIG_SND_BCM2708_SOC_HIFIBERRY_AMP is not set
+# CONFIG_SND_BCM2708_SOC_PIFI_40 is not set
+# CONFIG_SND_BCM2708_SOC_RPI_CIRRUS is not set
+# CONFIG_SND_BCM2708_SOC_RPI_DAC is not set
+# CONFIG_SND_BCM2708_SOC_RPI_PROTO is not set
+# CONFIG_SND_BCM2708_SOC_JUSTBOOM_BOTH is not set
+# CONFIG_SND_BCM2708_SOC_JUSTBOOM_DAC is not set
+# CONFIG_SND_BCM2708_SOC_JUSTBOOM_DIGI is not set
+# CONFIG_SND_BCM2708_SOC_IQAUDIO_CODEC is not set
+# CONFIG_SND_BCM2708_SOC_IQAUDIO_DAC is not set
+# CONFIG_SND_BCM2708_SOC_IQAUDIO_DIGI is not set
+# CONFIG_SND_BCM2708_SOC_I_SABRE_Q2M is not set
+# CONFIG_SND_BCM2708_SOC_ADAU1977_ADC is not set
+# CONFIG_SND_AUDIOINJECTOR_PI_SOUNDCARD is not set
+# CONFIG_SND_AUDIOINJECTOR_OCTO_SOUNDCARD is not set
+# CONFIG_SND_AUDIOINJECTOR_ISOLATED_SOUNDCARD is not set
+# CONFIG_SND_AUDIOSENSE_PI is not set
+# CONFIG_SND_DIGIDAC1_SOUNDCARD is not set
+# CONFIG_SND_BCM2708_SOC_DIONAUDIO_LOCO is not set
+# CONFIG_SND_BCM2708_SOC_DIONAUDIO_LOCO_V2 is not set
+# CONFIG_SND_BCM2708_SOC_ALLO_PIANO_DAC is not set
+# CONFIG_SND_BCM2708_SOC_ALLO_PIANO_DAC_PLUS is not set
+# CONFIG_SND_BCM2708_SOC_ALLO_BOSS_DAC is not set
+# CONFIG_SND_BCM2708_SOC_ALLO_BOSS2_DAC is not set
+# CONFIG_SND_BCM2708_SOC_ALLO_DIGIONE is not set
+# CONFIG_SND_BCM2708_SOC_ALLO_KATANA_DAC is not set
+# CONFIG_SND_BCM2708_SOC_FE_PI_AUDIO is not set
+# CONFIG_SND_PISOUND is not set
+# CONFIG_SND_RPI_SIMPLE_SOUNDCARD is not set
+# CONFIG_SND_RPI_WM8804_SOUNDCARD is not set
+# CONFIG_SND_DACBERRY400 is not set
 # CONFIG_SND_DESIGNWARE_I2S is not set
 
 #
@@ -5889,6 +5965,7 @@ CONFIG_SND_SOC_GENERIC_DMAENGINE_PCM=y
 # end of ASoC support for Amlogic platforms
 
 # CONFIG_SND_SOC_QCOM is not set
+# CONFIG_SND_RP1_AUDIO_OUT is not set
 # CONFIG_SND_SOC_ROCKCHIP is not set
 
 #
@@ -5929,6 +6006,8 @@ CONFIG_SND_SOC_I2C_AND_SPI=m
 # CODEC drivers
 #
 # CONFIG_SND_SOC_AC97_CODEC is not set
+# CONFIG_SND_SOC_AD193X_SPI is not set
+# CONFIG_SND_SOC_AD193X_I2C is not set
 # CONFIG_SND_SOC_ADAU1372_I2C is not set
 # CONFIG_SND_SOC_ADAU1372_SPI is not set
 # CONFIG_SND_SOC_ADAU1701 is not set
@@ -6001,6 +6080,7 @@ CONFIG_SND_SOC_HDMI_CODEC=m
 # CONFIG_SND_SOC_ICS43432 is not set
 # CONFIG_SND_SOC_IDT821034 is not set
 # CONFIG_SND_SOC_INNO_RK3036 is not set
+# CONFIG_SND_SOC_MA120X0P is not set
 # CONFIG_SND_SOC_MAX98088 is not set
 # CONFIG_SND_SOC_MAX98090 is not set
 # CONFIG_SND_SOC_MAX98357A is not set
@@ -6124,6 +6204,7 @@ CONFIG_SND_SOC_HDMI_CODEC=m
 # CONFIG_SND_SOC_LPASS_VA_MACRO is not set
 # CONFIG_SND_SOC_LPASS_RX_MACRO is not set
 # CONFIG_SND_SOC_LPASS_TX_MACRO is not set
+# CONFIG_SND_SOC_I_SABRE_CODEC is not set
 # end of CODEC drivers
 
 # CONFIG_SND_SIMPLE_CARD is not set
@@ -6336,6 +6417,7 @@ CONFIG_USB_OHCI_HCD_PLATFORM=y
 # CONFIG_USB_SL811_HCD is not set
 # CONFIG_USB_R8A66597_HCD is not set
 # CONFIG_USB_RENESAS_USBHS_HCD is not set
+# CONFIG_USB_DWCOTG is not set
 # CONFIG_USB_HCD_TEST_MODE is not set
 # CONFIG_USB_XEN_HCD is not set
 CONFIG_USB_RENESAS_USBHS=y
@@ -6679,6 +6761,8 @@ CONFIG_MMC_BLOCK_MINORS=32
 #
 # MMC/SD/SDIO Host Controller Drivers
 #
+# CONFIG_MMC_BCM2835_MMC is not set
+# CONFIG_MMC_BCM2835_SDHOST is not set
 # CONFIG_MMC_DEBUG is not set
 CONFIG_MMC_ARMMMCI=y
 CONFIG_MMC_QCOM_DML=y
@@ -6816,11 +6900,13 @@ CONFIG_LEDS_TRIGGER_DEFAULT_ON=y
 #
 # CONFIG_LEDS_TRIGGER_TRANSIENT is not set
 # CONFIG_LEDS_TRIGGER_CAMERA is not set
+# CONFIG_LEDS_TRIGGER_INPUT is not set
 # CONFIG_LEDS_TRIGGER_PANIC is not set
 # CONFIG_LEDS_TRIGGER_NETDEV is not set
 # CONFIG_LEDS_TRIGGER_PATTERN is not set
 # CONFIG_LEDS_TRIGGER_TTY is not set
 # CONFIG_LEDS_TRIGGER_INPUT_EVENTS is not set
+# CONFIG_LEDS_TRIGGER_ACTPWR is not set
 
 #
 # Simple LED drivers
@@ -6888,6 +6974,7 @@ CONFIG_RTC_INTF_DEV=y
 # CONFIG_RTC_DRV_ABB5ZES3 is not set
 # CONFIG_RTC_DRV_ABEOZ9 is not set
 # CONFIG_RTC_DRV_ABX80X is not set
+CONFIG_RTC_DRV_RPI=y
 CONFIG_RTC_DRV_BRCMSTB=y
 CONFIG_RTC_DRV_DS1307=y
 # CONFIG_RTC_DRV_DS1307_CENTURY is not set
@@ -7038,6 +7125,7 @@ CONFIG_PL330_DMA=y
 CONFIG_TEGRA186_GPC_DMA=y
 CONFIG_TEGRA20_APB_DMA=y
 CONFIG_TEGRA210_ADMA=y
+# CONFIG_DMA_BCM2708 is not set
 # CONFIG_XGENE_DMA is not set
 # CONFIG_XILINX_DMA is not set
 # CONFIG_XILINX_XDMA is not set
@@ -7208,6 +7296,8 @@ CONFIG_COMMON_CLK=y
 # CONFIG_COMMON_CLK_MAX77686 is not set
 # CONFIG_COMMON_CLK_MAX9485 is not set
 CONFIG_COMMON_CLK_RK808=y
+CONFIG_COMMON_CLK_RP1=y
+CONFIG_COMMON_CLK_RP1_SDIO=y
 CONFIG_COMMON_CLK_HI655X=y
 CONFIG_COMMON_CLK_SCMI=y
 CONFIG_COMMON_CLK_SCPI=y
@@ -7674,6 +7764,8 @@ CONFIG_ARM_SMMU_V3=y
 # CONFIG_QCOM_IOMMU is not set
 # CONFIG_VIRTIO_IOMMU is not set
 # CONFIG_SPRD_IOMMU is not set
+CONFIG_MBOX_RP1=y
+CONFIG_BCM2712_IOMMU=y
 
 #
 # Remoteproc drivers
@@ -8527,12 +8619,13 @@ CONFIG_PWM=y
 # CONFIG_PWM_AXI_PWMGEN is not set
 CONFIG_PWM_BCM_IPROC=y
 CONFIG_PWM_BCM2835=y
+CONFIG_PWM_PIO_RP1=y
 # CONFIG_PWM_BERLIN is not set
-# CONFIG_PWM_BRCMSTB is not set
+CONFIG_PWM_BRCMSTB=y
 # CONFIG_PWM_CLK is not set
 # CONFIG_PWM_DWC is not set
 # CONFIG_PWM_FSL_FTM is not set
-# CONFIG_PWM_GPIO is not set
+CONFIG_PWM_GPIO=y
 # CONFIG_PWM_HIBVT is not set
 # CONFIG_PWM_IMX1 is not set
 # CONFIG_PWM_IMX27 is not set
@@ -8543,6 +8636,7 @@ CONFIG_PWM_MESON=y
 # CONFIG_PWM_OMAP_DMTIMER is not set
 # CONFIG_PWM_PCA9685 is not set
 CONFIG_PWM_RASPBERRYPI_POE=y
+CONFIG_PWM_RP1=y
 # CONFIG_PWM_RCAR is not set
 # CONFIG_PWM_RENESAS_TPU is not set
 CONFIG_PWM_ROCKCHIP=y
@@ -8565,6 +8659,7 @@ CONFIG_ARM_GIC_V3=y
 CONFIG_ARM_GIC_V3_ITS=y
 CONFIG_IRQ_MSI_LIB=y
 # CONFIG_AL_FIC is not set
+CONFIG_BCM2712_MIP=y
 CONFIG_BCM7038_L1_IRQ=y
 CONFIG_BCM7120_L2_IRQ=y
 CONFIG_BRCMSTB_L2_IRQ=y
@@ -8766,6 +8861,7 @@ CONFIG_THUNDERX2_PMU=y
 # CONFIG_ARM_DMC620_PMU is not set
 # CONFIG_MARVELL_CN10K_TAD_PMU is not set
 # CONFIG_ALIBABA_UNCORE_DRW_PMU is not set
+# CONFIG_RPI_AXIPERF is not set
 CONFIG_HISI_PMU=m
 CONFIG_HISI_PCIE_PMU=m
 CONFIG_HNS3_PMU=m
@@ -8810,6 +8906,7 @@ CONFIG_NVMEM_LAYOUTS=y
 # CONFIG_NVMEM_LAYOUT_U_BOOT_ENV is not set
 # end of Layout Types
 
+CONFIG_NVMEM_RASPBERRYPI_OTP=y
 CONFIG_NVMEM_BCM_OCOTP=y
 # CONFIG_NVMEM_IMX_IIM is not set
 # CONFIG_NVMEM_IMX_OCOTP is not set
@@ -9697,7 +9794,6 @@ CONFIG_ARCH_HAS_SYNC_DMA_FOR_CPU=y
 CONFIG_ARCH_HAS_DMA_PREP_COHERENT=y
 CONFIG_SWIOTLB=y
 # CONFIG_SWIOTLB_DYNAMIC is not set
-CONFIG_DMA_BOUNCE_UNALIGNED_KMALLOC=y
 CONFIG_DMA_NEED_SYNC=y
 # CONFIG_DMA_RESTRICTED_POOL is not set
 CONFIG_DMA_NONCOHERENT_MMAP=y
diff --git a/kernel/prepare/pkg.yaml b/kernel/prepare/pkg.yaml
index 6408110..b507e5d 100644
--- a/kernel/prepare/pkg.yaml
+++ b/kernel/prepare/pkg.yaml
@@ -5,8 +5,8 @@ dependencies:
   - stage: base
 steps:
   - sources:
-      - url: https://cdn.kernel.org/pub/linux/kernel/v{{ regexReplaceAll "(\\d+)(.\\d+)(\\.\\d+)?$" .linux_version "${1}" }}.x/linux-{{ .linux_version }}.tar.xz
-        destination: linux.tar.xz
+      - url: "https://github.com/raspberrypi/linux/archive/refs/tags/{{ .linux_version }}.tar.gz"
+        destination: linux.tar.gz
         sha256: "{{ .linux_sha256 }}"
         sha512: "{{ .linux_sha512 }}"
       - url: https://github.com/a13xp0p0v/kernel-hardening-checker/archive/{{ .kspp_ref }}.tar.gz
@@ -18,7 +18,7 @@ steps:
     prepare:
       - |
         mkdir -p /src
-        tar -xJf linux.tar.xz --strip-components=1 -C /src
+        tar -xzf linux.tar.gz --strip-components=1 -C /src
 
         cd /src
         make mrproper
-- 
2.39.5 (Apple Git-154)

